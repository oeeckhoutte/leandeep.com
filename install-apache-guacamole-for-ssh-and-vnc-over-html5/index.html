<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author"
  content="Lean Deep">
<meta name="description"
  content="I struggled a little bit with the installation on Apache Guacamole. I think this tutorial will help some people. I installed it on Ubuntu 18.04.
Install VNC Install the following packages:
sudo apt-get install -y ubuntu-desktop gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal tightvncserver We are going to create a VNC startup script:
cd mkdir ~/.vnc Create a VNC startup script at this location ~/.vnc/xstartup and enter this content:
Option 1: Pour Ubuntu 18." />
<meta name="keywords" content="" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="#252627" />
<script>
  
  
  if (!(window.location.host.startsWith("127.0.0.1")) && !(window.location.host.startsWith("localhost"))) {
    if (window.location.protocol != "https:") {
      console.log("Redirecting to https...")
      window.location.protocol = "https";
    }
  }
</script>


<link rel="canonical" href="https://leandeep.com/install-apache-guacamole-for-ssh-and-vnc-over-html5/" />



<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
  #app {
    display: none;
    border-radius: 10px;
    box-shadow: 2px 5px 12px -1px rgba(0, 0, 0, 0.56);
    padding: 20px;
    background-color: white;
    max-width: 500px;
    margin: 15px auto;
    text-align: center;
    min-height: 500px;
  }

  #app input {
    margin: 0 auto;
    float: none;
    width: 100%;
    max-width: 300px;
    padding: 5px 10px;
    border: 2px solid black;
  }

  #app ul {
    margin: 0;
    padding: 0;
  }

  #app li {
    text-align: left;
    padding: 5px 10px;
    width: 100%;
    max-width: 280px;
    margin: 1px auto;
    background-color: white;
    border: 1px solid black;
    list-style: none;
  }
</style>




<title>
  
  Install Apache Guacamole for SSH and VNC over HTML5 :: Lean Deep Tech blog 
  
</title>



<link href="//cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.2.1/css/flag-icon.min.css" rel="stylesheet"
  type="text/css">



<link rel="stylesheet" href="https://leandeep.com/main.min.44eaa49e743eabd51724579f1d2ece0dac6f56215301d6961ca74092199d4a05.css">




    <link rel="apple-touch-icon" sizes="180x180" href="https://leandeep.com/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="https://leandeep.com/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://leandeep.com/favicon-16x16.png">
    <link rel="manifest" href="https://leandeep.com/site.webmanifest">
    <link rel="mask-icon" href="https://leandeep.com/safari-pinned-tab.svg" color="#252627">
    <link rel="shortcut icon" href="https://leandeep.com/favicon.ico">
    <meta name="msapplication-TileColor" content="#252627">
    <meta name="theme-color" content="#252627">

<meta itemprop="name" content="Install Apache Guacamole for SSH and VNC over HTML5">
<meta itemprop="description" content="I struggled a little bit with the installation on Apache Guacamole. I think this tutorial will help some people. I installed it on Ubuntu 18.04.
Install VNC Install the following packages:
sudo apt-get install -y ubuntu-desktop gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal tightvncserver We are going to create a VNC startup script:
cd mkdir ~/.vnc Create a VNC startup script at this location ~/.vnc/xstartup and enter this content:
Option 1: Pour Ubuntu 18."><meta itemprop="datePublished" content="2019-07-05T15:07:21+00:00" />
<meta itemprop="dateModified" content="2019-07-05T15:07:21+00:00" />
<meta itemprop="wordCount" content="1600"><meta itemprop="image" content="https://leandeep.com"/>
<meta itemprop="keywords" content="" /><meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://leandeep.com"/>

<meta name="twitter:title" content="Install Apache Guacamole for SSH and VNC over HTML5"/>
<meta name="twitter:description" content="I struggled a little bit with the installation on Apache Guacamole. I think this tutorial will help some people. I installed it on Ubuntu 18.04.
Install VNC Install the following packages:
sudo apt-get install -y ubuntu-desktop gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal tightvncserver We are going to create a VNC startup script:
cd mkdir ~/.vnc Create a VNC startup script at this location ~/.vnc/xstartup and enter this content:
Option 1: Pour Ubuntu 18."/>





<meta property="article:published_time" content="2019-07-05 15:07:21 &#43;0000 UTC" />







    </head>

    <body class="">
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="https://leandeep.com/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text">$ cd /home/leandeep</span>
            <span class="logo__cursor" style=""></span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="https://leandeep.com/events/">Featured Articles</a></li><li><a href="https://leandeep.com/posts/">All Articles</a></li><li><a href="https://leandeep.com/about/">About</a></li><li><a href="https://leandeep.com/finance/">Finance</a></li><li><a href="https://leandeep.com/notebooks/">ML Notebooks</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            

            <span class="theme-toggle unselectable"><svg class="theme-toggler" width="24" height="24" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"/>
</svg>
</span>
        </span>
    </span>
</header>

            <div class="content">
                
    <main class="post">

        <div class="post-info">
            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-clock"><circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline></svg>8 minutes

            

            </p>
        </div>

        <article>
            <h1 class="post-title">
                <a href="https://leandeep.com/install-apache-guacamole-for-ssh-and-vnc-over-html5/">Install Apache Guacamole for SSH and VNC over HTML5</a>
            </h1>

            

            <div class="post-content">
                <p>I struggled a little bit with the installation on Apache Guacamole. I think this tutorial will help some people. I installed it on Ubuntu 18.04.</p>
<br/>
<h2 id="install-vnc">Install VNC</h2>
<p>Install the following packages:</p>
<pre tabindex="0"><code>sudo apt-get install -y ubuntu-desktop gnome-panel gnome-settings-daemon metacity nautilus gnome-terminal tightvncserver
</code></pre><p>We are going to create a VNC startup script:</p>
<pre tabindex="0"><code>cd
mkdir ~/.vnc
</code></pre><p>Create a VNC startup script at this location <code>~/.vnc/xstartup</code> and enter this content:</p>
<br/>
<p><strong>Option 1: Pour Ubuntu 18.04 &ldquo;classique&rdquo; avec le desktop environment Gnome</strong></p>
<pre tabindex="0"><code>#!/bin/sh

xrdb $HOME/.Xresources
xsetroot -solid grey
#x-terminal-emulator -geometry 80x24+10+10 -ls -title &#34;$VNCDESKTOP Desktop&#34; &amp;
#x-window-manager &amp;
# Fix to make GNOME work
export XKL_XMODMAP_DISABLE=1
/etc/X11/Xsession

unset SESSION_MANAGER
vncconfig -iconic &amp;
x-terminal-emulator -geometry 80x24+10+10 -ls -title &#34;$VNCDESKTOP Desktop&#34; &amp;
x-window-manager &amp;
gnome-panel &amp;
gnome-settings-daemon &amp;
nautilus &amp;
metacity &amp;
gnome-session-flashback &amp;
</code></pre><br/>
<p><strong>Option 2: Pour Ubuntu Mate</strong></p>
<pre tabindex="0"><code>#!/bin/sh
unset DBUS_SESSION_BUS_ADDRESS
[ -x /etc/vnc/xstartup ] &amp;&amp; exec /etc/vnc/xstartup
[ -r $HOME/.Xresources ] &amp;&amp; xrdb $HOME/.Xresources
xsetroot -solid grey
vncconfig -iconic &amp;
x-terminal-emulator -geometry 80x24+10+10 -ls -title &#34;$VNCDESKTOP Desktop&#34; &amp;
x-window-manager &amp;
mate-session &amp;
</code></pre><p>Donner les droits d&rsquo;ex√©cution sur le fichier <code>~/.vnc/xstartup</code>:</p>
<pre tabindex="0"><code>sudo chmod +x ~/.vnc/xstartup
</code></pre><p>Reconfigure the session manager:</p>
<pre tabindex="0"><code>sudo update-alternatives --config x-session-manager
</code></pre><p>Select: <code>/usr/lib/gnome-flashback/gnome-flashback-metacity</code></p>
<blockquote>
<p>Fix rights issue:
<code>sudo chown -R olivier:olivier /home/olivier/.cache/dconf</code></p>
</blockquote>
<br/>
<h2 id="create-vnc-service">Create VNC service</h2>
<pre tabindex="0"><code>sudo vi /etc/systemd/system/vncserver@.service
</code></pre><p>Enter the following content. Replace <code>olivier</code> by your username.</p>
<pre tabindex="0"><code>[Unit]
Description=Start TightVNC server at startup
After=syslog.target network.target

[Service]
Type=forking
User=olivier
Group=olivier
WorkingDirectory=/home/olivier

PIDFile=/home/olivier/.vnc/%H:%i.pid
ExecStartPre=-/usr/bin/vncserver -kill :%i &gt; /dev/null 2&gt;&amp;1
ExecStart=/usr/bin/vncserver -depth 24 -geometry 1280x800 :%i
ExecStop=/usr/bin/vncserver -kill :%i

[Install]
WantedBy=multi-user.target
</code></pre><p>Configure vncserver. To do so execute <code>vncserver</code> and enter a vnc password. Do not create a readonly password. When you are done kill the running server.</p>
<pre tabindex="0"><code>vncserver -kill :1
</code></pre><p>Start the service:</p>
<pre tabindex="0"><code>sudo systemctl daemon-reload
sudo systemctl enable vncserver@1.service
sudo systemctl start vncserver@1
</code></pre><br/>
<h2 id="install-guacamole">Install Guacamole</h2>
<p>Create a install script and enter the following content:</p>
<pre tabindex="0"><code>#!/bin/bash

# Check if user is root or sudo
if ! [ $(id -u) = 0 ]; then echo &#34;Please run this script as sudo or root&#34;; exit 1 ; fi

# Version number of Guacamole to install
GUACVERSION=&#34;1.0.0&#34;

# Colors to use for output
YELLOW=&#39;\033[1;33m&#39;
BLUE=&#39;\033[0;34m&#39;
RED=&#39;\033[0;31m&#39;
GREEN=&#39;\033[0;32m&#39;
NC=&#39;\033[0m&#39; # No Color

# Log Location
LOG=&#34;/tmp/guacamole_${GUACVERSION}_build.log&#34;

# Get script arguments for non-interactive mode
while [ &#34;$1&#34; != &#34;&#34; ]; do
    case $1 in
        -m | --mysqlpwd )
            shift
            mysqlpwd=&#34;$1&#34;
            ;;
        -g | --guacpwd )
            shift
            guacpwd=&#34;$1&#34;
            ;;
        -u | --mysqluser )
            shift
            mysqluser=&#34;$1&#34;
            ;;
        -d | --database )
            shift
            DB=&#34;$1&#34;
            ;;
    esac
    shift
done

# Checking if mysql user given
if [ -z &#34;$mysqluser&#34; ]; then
    mysqluser=&#34;guacamole_user&#34;
fi

# Checking if database name given
if [ -z &#34;$DB&#34; ]; then
    DB=&#34;guacamole_db&#34;
fi

# Get MySQL root password and Guacamole User password
if [ -n &#34;$mysqlpwd&#34; ] &amp;&amp; [ -n &#34;$guacpwd&#34; ]; then
        mysqlrootpassword=$mysqlpwd
        guacdbuserpassword=$guacpwd
else
    echo
    while true
    do
        read -s -p &#34;Enter a MySQL ROOT Password: &#34; mysqlrootpassword
        echo
        read -s -p &#34;Confirm MySQL ROOT Password: &#34; password2
        echo
        [ &#34;$mysqlrootpassword&#34; = &#34;$password2&#34; ] &amp;&amp; break
        echo &#34;Passwords don&#39;t match. Please try again.&#34;
        echo
    done
    echo
    while true
    do
        read -s -p &#34;Enter a Guacamole User Database Password: &#34; guacdbuserpassword
        echo
        read -s -p &#34;Confirm Guacamole User Database Password: &#34; password2
        echo
        [ &#34;$guacdbuserpassword&#34; = &#34;$password2&#34; ] &amp;&amp; break
        echo &#34;Passwords don&#39;t match. Please try again.&#34;
        echo
    done
    echo
fi

debconf-set-selections &lt;&lt;&lt; &#34;mysql-server mysql-server/root_password password $mysqlrootpassword&#34;
debconf-set-selections &lt;&lt;&lt; &#34;mysql-server mysql-server/root_password_again password $mysqlrootpassword&#34;

# Ubuntu and Debian have different package names for libjpeg
# Ubuntu and Debian versions have differnet package names for libpng-dev
# Ubuntu 18.04 does not include universe repo by default
source /etc/os-release
if [[ &#34;${NAME}&#34; == &#34;Ubuntu&#34; ]]
then
    JPEGTURBO=&#34;libjpeg-turbo8-dev&#34;
    if [[ &#34;${VERSION_ID}&#34; == &#34;18.04&#34; ]]
    then
        sed -i &#39;s/bionic main$/bionic main universe/&#39; /etc/apt/sources.list
    fi
    if [[ &#34;${VERSION_ID}&#34; == &#34;16.04&#34; ]]
    then
        LIBPNG=&#34;libpng12-dev&#34;
    else
        LIBPNG=&#34;libpng-dev&#34;
    fi
elif [[ &#34;${NAME}&#34; == *&#34;Debian&#34;* ]]
then
    JPEGTURBO=&#34;libjpeg62-turbo-dev&#34;
    if [[ &#34;${PRETTY_NAME}&#34; == *&#34;stretch&#34;* ]]
    then
        LIBPNG=&#34;libpng-dev&#34;
    else
        LIBPNG=&#34;libpng12-dev&#34;
    fi
else
    echo &#34;Unsupported Distro - Ubuntu or Debian Only&#34;
    exit 1
fi

# Update apt so we can search apt-cache for newest tomcat version supported
apt-get -qq update

# Tomcat 8.0.x is End of Life, however Tomcat 7.x is not...
# If Tomcat 8.5.x or newer is available install it, otherwise install Tomcat 7
# I have not testing with Tomcat9...
if [[ $(apt-cache show tomcat8 | egrep &#34;Version: 8.[5-9]&#34; | wc -l) -gt 0 ]]
then
    TOMCAT=&#34;tomcat8&#34;
else
    TOMCAT=&#34;tomcat7&#34;
fi

if [ -z $(command -v mysql) ]
then
    MYSQL=&#34;mysql-server mysql-client mysql-common mysql-utilities&#34;
else
    MYSQL=&#34;&#34;
fi

# Uncomment to manually force a tomcat version
#TOMCAT=&#34;&#34;

# Install features
echo -e &#34;${BLUE}Installing dependencies. This might take a few minutes...${NC}&#34;

export DEBIAN_FRONTEND=noninteractive

apt-get -y install build-essential libcairo2-dev ${JPEGTURBO} ${LIBPNG} libossp-uuid-dev libavcodec-dev libavutil-dev \
libswscale-dev libfreerdp-dev libpango1.0-dev libssh2-1-dev libtelnet-dev libvncserver-dev libpulse-dev libssl-dev \
libvorbis-dev libwebp-dev ${MYSQL} libmysql-java ${TOMCAT} freerdp-x11 \
ghostscript wget dpkg-dev &amp;&gt;&gt; ${LOG}

if [ $? -ne 0 ]; then
    echo -e &#34;${RED}Failed. See ${LOG}${NC}&#34;
    exit 1
else
    echo -e &#34;${GREEN}OK${NC}&#34;
fi

# Set SERVER to be the preferred download server from the Apache CDN
SERVER=&#34;http://apache.org/dyn/closer.cgi?action=download&amp;filename=guacamole/${GUACVERSION}&#34;
echo -e &#34;${BLUE}Downloading Files...${NC}&#34;

# Download Guacamole Server
wget -q --show-progress -O guacamole-server-${GUACVERSION}.tar.gz ${SERVER}/source/guacamole-server-${GUACVERSION}.tar.gz
if [ $? -ne 0 ]; then
    echo -e &#34;${RED}Failed to download guacamole-server-${GUACVERSION}.tar.gz&#34;
    echo -e &#34;${SERVER}/source/guacamole-server-${GUACVERSION}.tar.gz${NC}&#34;
    exit 1
fi
echo -e &#34;${GREEN}Downloaded guacamole-server-${GUACVERSION}.tar.gz${NC}&#34;

# Download Guacamole Client
wget -q --show-progress -O guacamole-${GUACVERSION}.war ${SERVER}/binary/guacamole-${GUACVERSION}.war
if [ $? -ne 0 ]; then
    echo -e &#34;${RED}Failed to download guacamole-${GUACVERSION}.war&#34;
    echo -e &#34;${SERVER}/binary/guacamole-${GUACVERSION}.war${NC}&#34;
    exit 1
fi
echo -e &#34;${GREEN}Downloaded guacamole-${GUACVERSION}.war${NC}&#34;

# Download Guacamole authentication extensions (Database)
wget -q --show-progress -O guacamole-auth-jdbc-${GUACVERSION}.tar.gz ${SERVER}/binary/guacamole-auth-jdbc-${GUACVERSION}.tar.gz
if [ $? -ne 0 ]; then
    echo -e &#34;${RED}Failed to download guacamole-auth-jdbc-${GUACVERSION}.tar.gz&#34;
    echo -e &#34;${SERVER}/binary/guacamole-auth-jdbc-${GUACVERSION}.tar.gz&#34;
    exit 1
fi
echo -e &#34;${GREEN}Downloaded guacamole-auth-jdbc-${GUACVERSION}.tar.gz${NC}&#34;

# Download Guacamole authentication extensions (TOTP)
wget -q --show-progress -O guacamole-auth-totp-${GUACVERSION}.tar.gz ${SERVER}/binary/guacamole-auth-totp-${GUACVERSION}.tar.gz
if [ $? -ne 0 ]; then
    echo -e &#34;${RED}Failed to download guacamole-auth-totp-${GUACVERSION}.tar.gz&#34;
    echo -e &#34;${SERVER}/binary/guacamole-auth-totp-${GUACVERSION}.tar.gz&#34;
    exit 1
fi
echo -e &#34;${GREEN}Downloaded guacamole-auth-totp-${GUACVERSION}.tar.gz${NC}&#34;

echo -e &#34;${GREEN}Downloading complete.${NC}&#34;

# Extract Guacamole files
tar -xzf guacamole-server-${GUACVERSION}.tar.gz
tar -xzf guacamole-auth-jdbc-${GUACVERSION}.tar.gz
tar -xzf guacamole-auth-totp-${GUACVERSION}.tar.gz

# Make directories
mkdir -p /etc/guacamole/lib
mkdir -p /etc/guacamole/extensions

# Install guacd
cd guacamole-server-${GUACVERSION}

echo -e &#34;${BLUE}Building Guacamole with GCC $(gcc --version | head -n1 | grep -oP &#39;\)\K.*&#39; | awk &#39;{print $1}&#39;) ${NC}&#34;

echo -e &#34;${BLUE}Configuring. This might take a minute...${NC}&#34;
./configure --with-init-dir=/etc/init.d  &amp;&gt;&gt; ${LOG}
if [ $? -ne 0 ]; then
    echo -e &#34;${RED}Failed. See ${LOG}${NC}&#34;
    exit 1
else
    echo -e &#34;${GREEN}OK${NC}&#34;
fi

echo -e &#34;${BLUE}Running Make. This might take a few minutes...${NC}&#34;
make &amp;&gt;&gt; ${LOG}
if [ $? -ne 0 ]; then
    echo -e &#34;${RED}Failed. See ${LOG}${NC}&#34;
    exit 1
else
    echo -e &#34;${GREEN}OK${NC}&#34;
fi

echo -e &#34;${BLUE}Running Make Install...${NC}&#34;
make install &amp;&gt;&gt; ${LOG}
if [ $? -ne 0 ]; then
    echo -e &#34;${RED}Failed. See ${LOG}${NC}&#34;
    exit 1
else
    echo -e &#34;${GREEN}OK${NC}&#34;
fi

ldconfig
systemctl enable guacd
cd ..

# Get build-folder
BUILD_FOLDER=$(dpkg-architecture -qDEB_BUILD_GNU_TYPE)

# Move files to correct locations
mv guacamole-${GUACVERSION}.war /etc/guacamole/guacamole.war
ln -s /etc/guacamole/guacamole.war /var/lib/${TOMCAT}/webapps/
ln -s /usr/local/lib/freerdp/guac*.so /usr/lib/${BUILD_FOLDER}/freerdp/
ln -s /usr/share/java/mysql-connector-java.jar /etc/guacamole/lib/
cp guacamole-auth-jdbc-${GUACVERSION}/mysql/guacamole-auth-jdbc-mysql-${GUACVERSION}.jar /etc/guacamole/extensions/
cp guacamole-auth-totp-${GUACVERSION}/guacamole-auth-totp-${GUACVERSION}.jar /etc/guacamole/extensions/

# Configure guacamole.properties
rm -f /etc/guacamole/guacamole.properties
touch /etc/guacamole/guacamole.properties
echo &#34;mysql-hostname: localhost&#34; &gt;&gt; /etc/guacamole/guacamole.properties
echo &#34;mysql-port: 3306&#34; &gt;&gt; /etc/guacamole/guacamole.properties
echo &#34;mysql-database: ${DB}&#34; &gt;&gt; /etc/guacamole/guacamole.properties
echo &#34;mysql-username: ${mysqluser}&#34; &gt;&gt; /etc/guacamole/guacamole.properties
echo &#34;mysql-password: ${guacdbuserpassword}&#34; &gt;&gt; /etc/guacamole/guacamole.properties

# restart tomcat
echo -e &#34;${BLUE}Restarting tomcat...${NC}&#34;

service ${TOMCAT} restart
if [ $? -ne 0 ]; then
    echo -e &#34;${RED}Failed${NC}&#34;
    exit 1
else
    echo -e &#34;${GREEN}OK${NC}&#34;
fi

# Create guacamole_db and grant $mysqluser permissions to it

# SQL code
SQLCODE=&#34;
create database ${DB};
create user if not exists &#39;${mysqluser}&#39;@&#39;localhost&#39; identified by \&#34;${guacdbuserpassword}\&#34;;
GRANT SELECT,INSERT,UPDATE,DELETE ON guacamole_db.* TO &#39;${mysqluser}&#39;@&#39;localhost&#39;;
flush privileges;&#34;

# Execute SQL code
echo ${SQLCODE} | mysql -u root -p${mysqlrootpassword}

# Add Guacamole schema to newly created database
echo -e &#34;Adding db tables...&#34;
cat guacamole-auth-jdbc-${GUACVERSION}/mysql/schema/*.sql | mysql -u root -p${mysqlrootpassword} ${DB}
if [ $? -ne 0 ]; then
    echo -e &#34;${RED}Failed${NC}&#34;
    exit 1
else
    echo -e &#34;${GREEN}OK${NC}&#34;
fi

# Ensure guacd is started
service guacd start

# Cleanup
echo -e &#34;${BLUE}Cleanup install files...${NC}&#34;

rm -rf guacamole-*
if [ $? -ne 0 ]; then
    echo -e &#34;${RED}Failed${NC}&#34;
    exit 1
else
    echo -e &#34;${GREEN}OK${NC}&#34;
fi

echo -e &#34;${BLUE}Installation Complete\nhttp://localhost:8080/guacamole/\nDefault login guacadmin:guacadmin\nBe sure to change the password.${NC}&#34;
</code></pre><p>Give that script the execution right:</p>
<pre tabindex="0"><code>chmod +x install_guacamole.sh
</code></pre><p>Install Guacamole:</p>
<pre tabindex="0"><code>./install_guacamole.sh
</code></pre><br/>
<h2 id="configure-guacamole">Configure Guacamole</h2>
<p>Create a new user and create 2 connections (one for SSH and one for VNC).
This is very easy I do not describe this part.</p>
<p>At the end you will have this:
<img src="https://leandeep.com/images/guacamole-home.png" alt="image"></p>
<p><img src="https://leandeep.com/images/guacamole-ssh.png" alt="image"></p>
<p><img src="https://leandeep.com/images/guacamole-vnc.png" alt="image"></p>
<br/>
<h2 id="configurer-un-reverse-proxy-nginx">Configurer un reverse proxy Nginx</h2>
<p>Installer Nginx:</p>
<pre tabindex="0"><code>apt install nginx
</code></pre><p>Activer le service:</p>
<pre tabindex="0"><code>systemctl enable nginx
</code></pre><p>G√©n√©rer un certificat SSL/TLS auto-sign√©:</p>
<pre tabindex="0"><code>openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/ssl/private/guacamole-selfsigned.key -out /etc/ssl/certs/guacamole-selfsigned.crt
</code></pre><p>Configurer Nginx. Cr√©er le fichier <code>/etc/nginx/sites-available/nginx-guacamole-ssl</code> et ajoutez le contenu suivant:</p>
<pre tabindex="0"><code>server {
	listen 80;
	server_name guacamole.example.com;
	return 301 https://$host$request_uri;
}
server {
	listen 443 ssl;
	server_name guacamole.example.com;

	root /var/www/html;

	index index.html index.htm index.nginx-debian.html;
    
    	ssl_certificate /etc/ssl/certs/guacamole-selfsigned.crt;
	ssl_certificate_key /etc/ssl/private/guacamole-selfsigned.key;

	ssl_protocols TLSv1.2 TLSv1.3;
	ssl_prefer_server_ciphers on; 
	ssl_dhparam /etc/nginx/dhparam.pem;
	ssl_ciphers ECDHE-RSA-AES256-GCM-SHA512:DHE-RSA-AES256-GCM-SHA512:ECDHE-RSA-AES256-GCM-SHA384:DHE-RSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-SHA384;
	ssl_ecdh_curve secp384r1;
	ssl_session_timeout  10m;
	ssl_session_cache shared:SSL:10m;
	resolver 192.168.42.129 8.8.8.8 valid=300s;
	resolver_timeout 5s; 
	add_header Strict-Transport-Security &#34;max-age=63072000; includeSubDomains; preload&#34;;
	add_header X-Frame-Options DENY;
	add_header X-Content-Type-Options nosniff;
	add_header X-XSS-Protection &#34;1; mode=block&#34;;

	access_log  /var/log/nginx/guac_access.log;
	error_log  /var/log/nginx/guac_error.log;

	location / {
		    proxy_pass http://guacamole.example.com:8080/guacamole/;
		    proxy_buffering off;
		    proxy_http_version 1.1;
		    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
		    proxy_set_header Upgrade $http_upgrade;
		    proxy_set_header Connection $http_connection;
		    proxy_cookie_path /guacamole/ /;
	}

}
</code></pre><p>G√©n√©rer un certificat Deffie-Hellman pour avoir une cl√© d&rsquo;√©change. Le flag <code>-dsaparam</code> est ajout√© pour acc√©l√©rer la g√©n√©ration:</p>
<pre tabindex="0"><code>openssl dhparam -dsaparam -out /etc/nginx/dhparam.pem 4096
</code></pre><p>Activer la configuration Nginx:</p>
<pre tabindex="0"><code>ln -s /etc/nginx/sites-available/nginx-guacamole-ssl /etc/nginx/sites-enabled/
</code></pre><p>V√©rifier la bonne configuration:</p>
<pre tabindex="0"><code>nginx -t
 nginx: the configuration file /etc/nginx/nginx.conf syntax is ok
 nginx: configuration file /etc/nginx/nginx.conf test is successful
</code></pre><p>Restart Nginx:</p>
<pre tabindex="0"><code>systemctl restart nginx
</code></pre><br/>
<h2 id="troubleshooting">Troubleshooting</h2>
<p><strong>Acc√©der √† VNC via le r√©seau local</strong></p>
<p>Editer le fichier <code>/etc/systemd/system/vncserver@.service</code> et ajouter l&rsquo;option <code>-localhost no</code> au d√©marrage du service <code>ExecStart=/usr/bin/vncserver -localhost no ...</code>.</p>
<blockquote>
<p>Utiliser le port 5900 ou 5901</p>
</blockquote>

            </div>
        </article>

        <hr />

        <div class="post-info">

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file-text"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>1600 Mots</p>

            <p><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-calendar"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>05 juil.. 2019</p>
        </div>

        
            <div class="pagination">
                <div class="pagination__title">
                    <span class="pagination__title-h"></span>
                    <hr />
                </div>

                <div class="pagination__buttons">
                    
                        <span class="button previous">
                            <a href="https://leandeep.com/install-elasticsearch-on-ubuntu-18.04/">
                                <span class="button__icon">‚Üê</span>
                                <span class="button__text">Install Elasticsearch on Ubuntu 18.04 </span>
                            </a>
                        </span>
                    

                    
                        <span class="button next">
                            <a href="https://leandeep.com/install-ohmyzsh-on-ubuntu-18.04/">
                                <span class="button__text">Install ohmyzsh on Ubuntu 18.04</span>
                                <span class="button__icon">‚Üí</span>
                            </a>
                        </span>
                    
                </div>
            </div>
        

        
    </main>

            </div>

            
                <footer class="footer">
    <div class="footer__inner">
        <div class="footer__content">
            <span>Built by <a href="https://www.linkedin.com/in/oliviereeckhoutte/">Olivier Eeckhoutte</a>,
                Freelance @ LeanDeep <a href="https://leandeep.com/about/">(üçÉ company)</a></span>
            <span>Siret: 83825337500011</span>
            <span><a href="https://leandeep.com/posts/index.xml" target="_blank" title="rss"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss">
                        <path d="M4 11a9 9 0 0 1 9 9"></path>
                        <path d="M4 4a16 16 0 0 1 16 16"></path>
                        <circle cx="5" cy="19" r="1"></circle>
                    </svg></a></span>
        </div>
    </div>
</footer>
            
        </div>

        




<script type="text/javascript" src="https://leandeep.com/bundle.min.c184f8481b5847ad1a7d8aa775944fa063f118cb4df68f4eaa3826a2a2e16b26a1ad798f5160210f265c6fbb9a5f19b953fed066ae1ed1092d1858bcff13ae92.js" integrity="sha512-wYT4SBtYR60afYqndZRPoGPxGMtN9o9OqjgmoqLhayahrXmPUWAhDyZcb7uaXxm5U/7QZq4e0QktGFi8/xOukg=="></script>







    </body>
</html>
