<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>VPN on Lean Deep Tech blog</title>
    <link>https://leandeep.com/tags/vpn/</link>
    <description>Recent content in VPN on Lean Deep Tech blog</description>
    <generator>Hugo</generator>
    <language>fr</language>
    <copyright>&lt;a href=&#34;https://creativecommons.org/licenses/by-nc/4.0/&#34; target=&#34;_blank&#34; rel=&#34;noopener&#34;&gt;CC BY-NC 4.0&lt;/a&gt;</copyright>
    <lastBuildDate>Sat, 24 Feb 2024 18:10:00 +0000</lastBuildDate>
    <atom:link href="https://leandeep.com/tags/vpn/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>Install tailscale and Pi Hole on Debian 11 Bullseye</title>
      <link>https://leandeep.com/install-tailscale-and-pi-hole-on-debian-11-bullseye/</link>
      <pubDate>Sat, 24 Feb 2024 18:10:00 +0000</pubDate>
      <guid>https://leandeep.com/install-tailscale-and-pi-hole-on-debian-11-bullseye/</guid>
      <description>&lt;p&gt;In this short article we are going to see the commands to install Tailscale (and PiHole) on a Raspberry Pi version 2 and Debian 11 Bullseye (or Raspios equivalent of Debian 11).&lt;/p&gt;&#xA;&lt;br/&gt;&#xA;&lt;p&gt;&lt;strong&gt;Pré-requis&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;A Raspberry Pi 2 connected to internet&lt;/li&gt;&#xA;&lt;li&gt;A fresh Debian 11 installation&lt;/li&gt;&#xA;&lt;/ul&gt;&#xA;&lt;br/&gt;&#xA;&lt;p&gt;&lt;strong&gt;OS preparation&lt;/strong&gt;&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo apt update&#xA;sudo apt upgrade -y&#xA;# Grab a large coffee. It takes forever...&#xA;sudo reboot&#xA;sudo apt install curl -y&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;br/&gt;&#xA;&lt;p&gt;&lt;strong&gt;Pi Hole installation&lt;/strong&gt;&lt;/p&gt;</description>
    </item>
    <item>
      <title>Créer un serveur OpenVPN en 5 minutes</title>
      <link>https://leandeep.com/cr%C3%A9er-un-serveur-openvpn-en-5-minutes/</link>
      <pubDate>Thu, 12 Mar 2020 19:35:00 +0200</pubDate>
      <guid>https://leandeep.com/cr%C3%A9er-un-serveur-openvpn-en-5-minutes/</guid>
      <description>&lt;p&gt;Dans cet article, vous trouverez un script permettant de créer une serveur OpenVPN sur Ubuntu 18.04.&lt;/p&gt;&#xA;&lt;p&gt;En sortie du script, un fichier config.ovpn sera créé. Il suffit de l&amp;rsquo;ajouter à un client VPN (i.e. tunnelblick sur Mac) et d&amp;rsquo;établir une connexion.&lt;/p&gt;&#xA;&lt;p&gt;Vous pourrez vous connecter à la machine sur laquelle est installée le serveur VPN. Il suffit d&amp;rsquo;exécutez la commande &lt;code&gt;ssh VOTRE_USER@10.8.0.1&lt;/code&gt;&amp;hellip;&lt;/p&gt;&#xA;&lt;p&gt;Voici le fameux script:&lt;/p&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;#!/bin/bash&#xA;&#xA;if grep -qs &amp;#34;Ubuntu 16.04&amp;#34; &amp;#34;/etc/os-release&amp;#34;; then&#xA;&#x9;echo &amp;#39;Ubuntu 16.04 is no longer supported in the current version of openvpn-install&#xA;Use an older version if Ubuntu 16.04 support is needed: https://git.io/vpn1604&amp;#39;&#xA;&#x9;exit&#xA;fi&#xA;&#xA;# Detect Debian users running the script with &amp;#34;sh&amp;#34; instead of bash&#xA;if readlink /proc/$$/exe | grep -q &amp;#34;dash&amp;#34;; then&#xA;&#x9;echo &amp;#34;This script needs to be run with bash, not sh&amp;#34;&#xA;&#x9;exit&#xA;fi&#xA;&#xA;if [[ &amp;#34;$EUID&amp;#34; -ne 0 ]]; then&#xA;&#x9;echo &amp;#34;Sorry, you need to run this as root&amp;#34;&#xA;&#x9;exit&#xA;fi&#xA;&#xA;if [[ ! -e /dev/net/tun ]]; then&#xA;&#x9;echo &amp;#34;The TUN device is not available&#xA;You need to enable TUN before running this script&amp;#34;&#xA;&#x9;exit&#xA;fi&#xA;&#xA;if [[ -e /etc/debian_version ]]; then&#xA;&#x9;OS=debian&#xA;&#x9;GROUPNAME=nogroup&#xA;elif [[ -e /etc/centos-release || -e /etc/redhat-release ]]; then&#xA;&#x9;OS=centos&#xA;&#x9;GROUPNAME=nobody&#xA;else&#xA;&#x9;echo &amp;#34;Looks like you aren&amp;#39;t running this installer on Debian, Ubuntu or CentOS&amp;#34;&#xA;&#x9;exit&#xA;fi&#xA;&#xA;newclient () {&#xA;&#x9;# Generates the custom client.ovpn&#xA;&#x9;cp /etc/openvpn/server/client-common.txt ~/$1.ovpn&#xA;&#x9;echo &amp;#34;&amp;lt;ca&amp;gt;&amp;#34; &amp;gt;&amp;gt; ~/$1.ovpn&#xA;&#x9;cat /etc/openvpn/server/easy-rsa/pki/ca.crt &amp;gt;&amp;gt; ~/$1.ovpn&#xA;&#x9;echo &amp;#34;&amp;lt;/ca&amp;gt;&amp;#34; &amp;gt;&amp;gt; ~/$1.ovpn&#xA;&#x9;echo &amp;#34;&amp;lt;cert&amp;gt;&amp;#34; &amp;gt;&amp;gt; ~/$1.ovpn&#xA;&#x9;sed -ne &amp;#39;/BEGIN CERTIFICATE/,$ p&amp;#39; /etc/openvpn/server/easy-rsa/pki/issued/$1.crt &amp;gt;&amp;gt; ~/$1.ovpn&#xA;&#x9;echo &amp;#34;&amp;lt;/cert&amp;gt;&amp;#34; &amp;gt;&amp;gt; ~/$1.ovpn&#xA;&#x9;echo &amp;#34;&amp;lt;key&amp;gt;&amp;#34; &amp;gt;&amp;gt; ~/$1.ovpn&#xA;&#x9;cat /etc/openvpn/server/easy-rsa/pki/private/$1.key &amp;gt;&amp;gt; ~/$1.ovpn&#xA;&#x9;echo &amp;#34;&amp;lt;/key&amp;gt;&amp;#34; &amp;gt;&amp;gt; ~/$1.ovpn&#xA;&#x9;echo &amp;#34;&amp;lt;tls-auth&amp;gt;&amp;#34; &amp;gt;&amp;gt; ~/$1.ovpn&#xA;&#x9;sed -ne &amp;#39;/BEGIN OpenVPN Static key/,$ p&amp;#39; /etc/openvpn/server/ta.key &amp;gt;&amp;gt; ~/$1.ovpn&#xA;&#x9;echo &amp;#34;&amp;lt;/tls-auth&amp;gt;&amp;#34; &amp;gt;&amp;gt; ~/$1.ovpn&#xA;}&#xA;&#xA;if [[ -e /etc/openvpn/server/server.conf ]]; then&#xA;&#x9;while :&#xA;&#x9;do&#xA;&#x9;clear&#xA;&#x9;&#x9;echo &amp;#34;Looks like OpenVPN is already installed.&amp;#34;&#xA;&#x9;&#x9;echo&#xA;&#x9;&#x9;echo &amp;#34;What do you want to do?&amp;#34;&#xA;&#x9;&#x9;echo &amp;#34;   1) Add a new user&amp;#34;&#xA;&#x9;&#x9;echo &amp;#34;   2) Revoke an existing user&amp;#34;&#xA;&#x9;&#x9;echo &amp;#34;   3) Remove OpenVPN&amp;#34;&#xA;&#x9;&#x9;echo &amp;#34;   4) Exit&amp;#34;&#xA;&#x9;&#x9;read -p &amp;#34;Select an option [1-4]: &amp;#34; option&#xA;&#x9;&#x9;case $option in&#xA;&#x9;&#x9;&#x9;1) &#xA;&#x9;&#x9;&#x9;echo&#xA;&#x9;&#x9;&#x9;echo &amp;#34;Tell me a name for the client certificate.&amp;#34;&#xA;&#x9;&#x9;&#x9;echo &amp;#34;Please, use one word only, no special characters.&amp;#34;&#xA;&#x9;&#x9;&#x9;read -p &amp;#34;Client name: &amp;#34; -e CLIENT&#xA;&#x9;&#x9;&#x9;cd /etc/openvpn/server/easy-rsa/&#xA;&#x9;&#x9;&#x9;EASYRSA_CERT_EXPIRE=3650 ./easyrsa build-client-full $CLIENT nopass&#xA;&#x9;&#x9;&#x9;# Generates the custom client.ovpn&#xA;&#x9;&#x9;&#x9;newclient &amp;#34;$CLIENT&amp;#34;&#xA;&#x9;&#x9;&#x9;echo&#xA;&#x9;&#x9;&#x9;echo &amp;#34;Client $CLIENT added, configuration is available at:&amp;#34; ~/&amp;#34;$CLIENT.ovpn&amp;#34;&#xA;&#x9;&#x9;&#x9;exit&#xA;&#x9;&#x9;&#x9;;;&#xA;&#x9;&#x9;&#x9;2)&#xA;&#x9;&#x9;&#x9;# This option could be documented a bit better and maybe even be simplified&#xA;&#x9;&#x9;&#x9;# ...but what can I say, I want some sleep too&#xA;&#x9;&#x9;&#x9;NUMBEROFCLIENTS=$(tail -n +2 /etc/openvpn/server/easy-rsa/pki/index.txt | grep -c &amp;#34;^V&amp;#34;)&#xA;&#x9;&#x9;&#x9;if [[ &amp;#34;$NUMBEROFCLIENTS&amp;#34; = &amp;#39;0&amp;#39; ]]; then&#xA;&#x9;&#x9;&#x9;&#x9;echo&#xA;&#x9;&#x9;&#x9;&#x9;echo &amp;#34;You have no existing clients!&amp;#34;&#xA;&#x9;&#x9;&#x9;&#x9;exit&#xA;&#x9;&#x9;&#x9;fi&#xA;&#x9;&#x9;&#x9;echo&#xA;&#x9;&#x9;&#x9;echo &amp;#34;Select the existing client certificate you want to revoke:&amp;#34;&#xA;&#x9;&#x9;&#x9;tail -n +2 /etc/openvpn/server/easy-rsa/pki/index.txt | grep &amp;#34;^V&amp;#34; | cut -d &amp;#39;=&amp;#39; -f 2 | nl -s &amp;#39;) &amp;#39;&#xA;&#x9;&#x9;&#x9;if [[ &amp;#34;$NUMBEROFCLIENTS&amp;#34; = &amp;#39;1&amp;#39; ]]; then&#xA;&#x9;&#x9;&#x9;&#x9;read -p &amp;#34;Select one client [1]: &amp;#34; CLIENTNUMBER&#xA;&#x9;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;&#x9;read -p &amp;#34;Select one client [1-$NUMBEROFCLIENTS]: &amp;#34; CLIENTNUMBER&#xA;&#x9;&#x9;&#x9;fi&#xA;&#x9;&#x9;&#x9;CLIENT=$(tail -n +2 /etc/openvpn/server/easy-rsa/pki/index.txt | grep &amp;#34;^V&amp;#34; | cut -d &amp;#39;=&amp;#39; -f 2 | sed -n &amp;#34;$CLIENTNUMBER&amp;#34;p)&#xA;&#x9;&#x9;&#x9;echo&#xA;&#x9;&#x9;&#x9;read -p &amp;#34;Do you really want to revoke access for client $CLIENT? [y/N]: &amp;#34; -e REVOKE&#xA;&#x9;&#x9;&#x9;if [[ &amp;#34;$REVOKE&amp;#34; = &amp;#39;y&amp;#39; || &amp;#34;$REVOKE&amp;#34; = &amp;#39;Y&amp;#39; ]]; then&#xA;&#x9;&#x9;&#x9;&#x9;cd /etc/openvpn/server/easy-rsa/&#xA;&#x9;&#x9;&#x9;&#x9;./easyrsa --batch revoke $CLIENT&#xA;&#x9;&#x9;&#x9;&#x9;EASYRSA_CRL_DAYS=3650 ./easyrsa gen-crl&#xA;&#x9;&#x9;&#x9;&#x9;rm -f pki/reqs/$CLIENT.req&#xA;&#x9;&#x9;&#x9;&#x9;rm -f pki/private/$CLIENT.key&#xA;&#x9;&#x9;&#x9;&#x9;rm -f pki/issued/$CLIENT.crt&#xA;&#x9;&#x9;&#x9;&#x9;rm -f /etc/openvpn/server/crl.pem&#xA;&#x9;&#x9;&#x9;&#x9;cp /etc/openvpn/server/easy-rsa/pki/crl.pem /etc/openvpn/server/crl.pem&#xA;&#x9;&#x9;&#x9;&#x9;# CRL is read with each client connection, when OpenVPN is dropped to nobody&#xA;&#x9;&#x9;&#x9;&#x9;chown nobody:$GROUPNAME /etc/openvpn/server/crl.pem&#xA;&#x9;&#x9;&#x9;&#x9;echo&#xA;&#x9;&#x9;&#x9;&#x9;echo &amp;#34;Certificate for client $CLIENT revoked!&amp;#34;&#xA;&#x9;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;&#x9;echo&#xA;&#x9;&#x9;&#x9;&#x9;echo &amp;#34;Certificate revocation for client $CLIENT aborted!&amp;#34;&#xA;&#x9;&#x9;&#x9;fi&#xA;&#x9;&#x9;&#x9;exit&#xA;&#x9;&#x9;&#x9;;;&#xA;&#x9;&#x9;&#x9;3) &#xA;&#x9;&#x9;&#x9;echo&#xA;&#x9;&#x9;&#x9;read -p &amp;#34;Do you really want to remove OpenVPN? [y/N]: &amp;#34; -e REMOVE&#xA;&#x9;&#x9;&#x9;if [[ &amp;#34;$REMOVE&amp;#34; = &amp;#39;y&amp;#39; || &amp;#34;$REMOVE&amp;#34; = &amp;#39;Y&amp;#39; ]]; then&#xA;&#x9;&#x9;&#x9;&#x9;PORT=$(grep &amp;#39;^port &amp;#39; /etc/openvpn/server/server.conf | cut -d &amp;#34; &amp;#34; -f 2)&#xA;&#x9;&#x9;&#x9;&#x9;PROTOCOL=$(grep &amp;#39;^proto &amp;#39; /etc/openvpn/server/server.conf | cut -d &amp;#34; &amp;#34; -f 2)&#xA;&#x9;&#x9;&#x9;&#x9;if pgrep firewalld; then&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;IP=$(firewall-cmd --direct --get-rules ipv4 nat POSTROUTING | grep &amp;#39;\-s 10.8.0.0/24 &amp;#39;&amp;#34;&amp;#39;&amp;#34;&amp;#39;!&amp;#39;&amp;#34;&amp;#39;&amp;#34;&amp;#39; -d 10.8.0.0/24 -j SNAT --to &amp;#39; | cut -d &amp;#34; &amp;#34; -f 10)&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;# Using both permanent and not permanent rules to avoid a firewalld reload.&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;firewall-cmd --remove-port=$PORT/$PROTOCOL&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;firewall-cmd --zone=trusted --remove-source=10.8.0.0/24&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;firewall-cmd --permanent --remove-port=$PORT/$PROTOCOL&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;firewall-cmd --permanent --zone=trusted --remove-source=10.8.0.0/24&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;firewall-cmd --direct --remove-rule ipv4 nat POSTROUTING 0 -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to $IP&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;firewall-cmd --permanent --direct --remove-rule ipv4 nat POSTROUTING 0 -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to $IP&#xA;&#x9;&#x9;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;systemctl disable --now openvpn-iptables.service&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;rm -f /etc/systemd/system/openvpn-iptables.service&#xA;&#x9;&#x9;&#x9;&#x9;fi&#xA;&#x9;&#x9;&#x9;&#x9;if sestatus 2&amp;gt;/dev/null | grep &amp;#34;Current mode&amp;#34; | grep -q &amp;#34;enforcing&amp;#34; &amp;amp;&amp;amp; [[ &amp;#34;$PORT&amp;#34; != &amp;#39;1194&amp;#39; ]]; then&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;semanage port -d -t openvpn_port_t -p $PROTOCOL $PORT&#xA;&#x9;&#x9;&#x9;&#x9;fi&#xA;&#x9;&#x9;&#x9;&#x9;systemctl disable --now openvpn-server@server.service&#xA;&#x9;&#x9;&#x9;&#x9;rm -rf /etc/openvpn/server&#xA;&#x9;&#x9;&#x9;&#x9;rm -f /etc/sysctl.d/30-openvpn-forward.conf&#xA;&#x9;&#x9;&#x9;&#x9;if [[ &amp;#34;$OS&amp;#34; = &amp;#39;debian&amp;#39; ]]; then&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;apt-get remove --purge -y openvpn&#xA;&#x9;&#x9;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;&#x9;&#x9;yum remove openvpn -y&#xA;&#x9;&#x9;&#x9;&#x9;fi&#xA;&#x9;&#x9;&#x9;&#x9;echo&#xA;&#x9;&#x9;&#x9;&#x9;echo &amp;#34;OpenVPN removed!&amp;#34;&#xA;&#x9;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;&#x9;echo&#xA;&#x9;&#x9;&#x9;&#x9;echo &amp;#34;Removal aborted!&amp;#34;&#xA;&#x9;&#x9;&#x9;fi&#xA;&#x9;&#x9;&#x9;exit&#xA;&#x9;&#x9;&#x9;;;&#xA;&#x9;&#x9;&#x9;4) exit;;&#xA;&#x9;&#x9;esac&#xA;&#x9;done&#xA;else&#xA;&#x9;clear&#xA;&#x9;echo &amp;#39;Welcome to this OpenVPN &amp;#34;road warrior&amp;#34; installer!&amp;#39;&#xA;&#x9;echo&#xA;&#x9;# OpenVPN setup and first user creation&#xA;&#x9;echo &amp;#34;I need to ask you a few questions before starting the setup.&amp;#34;&#xA;&#x9;echo &amp;#34;You can leave the default options and just press enter if you are ok with them.&amp;#34;&#xA;&#x9;echo&#xA;&#x9;echo &amp;#34;First, provide the IPv4 address of the network interface you want OpenVPN&amp;#34;&#xA;&#x9;echo &amp;#34;listening to.&amp;#34;&#xA;&#x9;# Autodetect IP address and pre-fill for the user&#xA;&#x9;IP=$(ip addr | grep &amp;#39;inet&amp;#39; | grep -v inet6 | grep -vE &amp;#39;127\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}&amp;#39; | grep -oE &amp;#39;[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}&amp;#39; | head -1)&#xA;&#x9;read -p &amp;#34;IP address: &amp;#34; -e -i $IP IP&#xA;&#x9;# If $IP is a private IP address, the server must be behind NAT&#xA;&#x9;if echo &amp;#34;$IP&amp;#34; | grep -qE &amp;#39;^(10\.|172\.1[6789]\.|172\.2[0-9]\.|172\.3[01]\.|192\.168)&amp;#39;; then&#xA;&#x9;&#x9;echo&#xA;&#x9;&#x9;echo &amp;#34;This server is behind NAT. What is the public IPv4 address or hostname?&amp;#34;&#xA;&#x9;&#x9;read -p &amp;#34;Public IP address / hostname: &amp;#34; -e PUBLICIP&#xA;&#x9;fi&#xA;&#x9;echo&#xA;&#x9;echo &amp;#34;Which protocol do you want for OpenVPN connections?&amp;#34;&#xA;&#x9;echo &amp;#34;   1) UDP (recommended)&amp;#34;&#xA;&#x9;echo &amp;#34;   2) TCP&amp;#34;&#xA;&#x9;read -p &amp;#34;Protocol [1-2]: &amp;#34; -e -i 1 PROTOCOL&#xA;&#x9;case $PROTOCOL in&#xA;&#x9;&#x9;1) &#xA;&#x9;&#x9;PROTOCOL=udp&#xA;&#x9;&#x9;;;&#xA;&#x9;&#x9;2) &#xA;&#x9;&#x9;PROTOCOL=tcp&#xA;&#x9;&#x9;;;&#xA;&#x9;esac&#xA;&#x9;echo&#xA;&#x9;echo &amp;#34;What port do you want OpenVPN listening to?&amp;#34;&#xA;&#x9;read -p &amp;#34;Port: &amp;#34; -e -i 1194 PORT&#xA;&#x9;echo&#xA;&#x9;echo &amp;#34;Which DNS do you want to use with the VPN?&amp;#34;&#xA;&#x9;echo &amp;#34;   1) Current system resolvers&amp;#34;&#xA;&#x9;echo &amp;#34;   2) 1.1.1.1&amp;#34;&#xA;&#x9;echo &amp;#34;   3) Google&amp;#34;&#xA;&#x9;echo &amp;#34;   4) OpenDNS&amp;#34;&#xA;&#x9;echo &amp;#34;   5) Verisign&amp;#34;&#xA;&#x9;read -p &amp;#34;DNS [1-5]: &amp;#34; -e -i 1 DNS&#xA;&#x9;echo&#xA;&#x9;echo &amp;#34;Finally, tell me your name for the client certificate.&amp;#34;&#xA;&#x9;echo &amp;#34;Please, use one word only, no special characters.&amp;#34;&#xA;&#x9;read -p &amp;#34;Client name: &amp;#34; -e -i client CLIENT&#xA;&#x9;echo&#xA;&#x9;echo &amp;#34;Okay, that was all I needed. We are ready to set up your OpenVPN server now.&amp;#34;&#xA;&#x9;read -n1 -r -p &amp;#34;Press any key to continue...&amp;#34;&#xA;&#x9;if [[ &amp;#34;$OS&amp;#34; = &amp;#39;debian&amp;#39; ]]; then&#xA;&#x9;&#x9;apt-get update&#xA;&#x9;&#x9;apt-get install openvpn iptables openssl ca-certificates -y&#xA;&#x9;else&#xA;&#x9;&#x9;# Else, the distro is CentOS&#xA;&#x9;&#x9;yum install epel-release -y&#xA;&#x9;&#x9;yum install openvpn iptables openssl ca-certificates -y&#xA;&#x9;fi&#xA;&#x9;# Get easy-rsa&#xA;&#x9;EASYRSAURL=&amp;#39;https://github.com/OpenVPN/easy-rsa/releases/download/v3.0.5/EasyRSA-nix-3.0.5.tgz&amp;#39;&#xA;&#x9;wget -O ~/easyrsa.tgz &amp;#34;$EASYRSAURL&amp;#34; 2&amp;gt;/dev/null || curl -Lo ~/easyrsa.tgz &amp;#34;$EASYRSAURL&amp;#34;&#xA;&#x9;tar xzf ~/easyrsa.tgz -C ~/&#xA;&#x9;mv ~/EasyRSA-3.0.5/ /etc/openvpn/server/&#xA;&#x9;mv /etc/openvpn/server/EasyRSA-3.0.5/ /etc/openvpn/server/easy-rsa/&#xA;&#x9;chown -R root:root /etc/openvpn/server/easy-rsa/&#xA;&#x9;rm -f ~/easyrsa.tgz&#xA;&#x9;cd /etc/openvpn/server/easy-rsa/&#xA;&#x9;# Create the PKI, set up the CA and the server and client certificates&#xA;&#x9;./easyrsa init-pki&#xA;&#x9;./easyrsa --batch build-ca nopass&#xA;&#x9;EASYRSA_CERT_EXPIRE=3650 ./easyrsa build-server-full server nopass&#xA;&#x9;EASYRSA_CERT_EXPIRE=3650 ./easyrsa build-client-full $CLIENT nopass&#xA;&#x9;EASYRSA_CRL_DAYS=3650 ./easyrsa gen-crl&#xA;&#x9;# Move the stuff we need&#xA;&#x9;cp pki/ca.crt pki/private/ca.key pki/issued/server.crt pki/private/server.key pki/crl.pem /etc/openvpn/server&#xA;&#x9;# CRL is read with each client connection, when OpenVPN is dropped to nobody&#xA;&#x9;chown nobody:$GROUPNAME /etc/openvpn/server/crl.pem&#xA;&#x9;# Generate key for tls-auth&#xA;&#x9;openvpn --genkey --secret /etc/openvpn/server/ta.key&#xA;&#x9;# Create the DH parameters file using the predefined ffdhe2048 group&#xA;&#x9;echo &amp;#39;-----BEGIN DH PARAMETERS-----&#xA;MIIBCAKCAQEA//////////+t+FRYortKmq/cViAnPTzx2LnFg84tNpWp4TZBFGQz&#xA;+8yTnc4kmz75fS/jY2MMddj2gbICrsRhetPfHtXV/WVhJDP1H18GbtCFY2VVPe0a&#xA;87VXE15/V8k1mE8McODmi3fipona8+/och3xWKE2rec1MKzKT0g6eXq8CrGCsyT7&#xA;YdEIqUuyyOP7uWrat2DX9GgdT0Kj3jlN9K5W7edjcrsZCwenyO4KbXCeAvzhzffi&#xA;7MA0BM0oNC9hkXL+nOmFg/+OTxIy7vKBg8P+OxtMb61zO7X8vC7CIAXFjvGDfRaD&#xA;ssbzSibBsu/6iGtCOGEoXJf//////////wIBAg==&#xA;-----END DH PARAMETERS-----&amp;#39; &amp;gt; /etc/openvpn/server/dh.pem&#xA;&#x9;# Generate server.conf&#xA;&#x9;echo &amp;#34;port $PORT&#xA;proto $PROTOCOL&#xA;dev tun&#xA;sndbuf 0&#xA;rcvbuf 0&#xA;ca ca.crt&#xA;cert server.crt&#xA;key server.key&#xA;dh dh.pem&#xA;auth SHA512&#xA;tls-auth ta.key 0&#xA;topology subnet&#xA;server 10.8.0.0 255.255.255.0&#xA;ifconfig-pool-persist ipp.txt&amp;#34; &amp;gt; /etc/openvpn/server/server.conf&#xA;&#x9;echo &amp;#39;push &amp;#34;redirect-gateway def1 bypass-dhcp&amp;#34;&amp;#39; &amp;gt;&amp;gt; /etc/openvpn/server/server.conf&#xA;&#x9;# DNS&#xA;&#x9;case $DNS in&#xA;&#x9;&#x9;1)&#xA;&#x9;&#x9;# Locate the proper resolv.conf&#xA;&#x9;&#x9;# Needed for systems running systemd-resolved&#xA;&#x9;&#x9;if grep -q &amp;#34;127.0.0.53&amp;#34; &amp;#34;/etc/resolv.conf&amp;#34;; then&#xA;&#x9;&#x9;&#x9;RESOLVCONF=&amp;#39;/run/systemd/resolve/resolv.conf&amp;#39;&#xA;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;RESOLVCONF=&amp;#39;/etc/resolv.conf&amp;#39;&#xA;&#x9;&#x9;fi&#xA;&#x9;&#x9;# Obtain the resolvers from resolv.conf and use them for OpenVPN&#xA;&#x9;&#x9;grep -v &amp;#39;#&amp;#39; $RESOLVCONF | grep &amp;#39;nameserver&amp;#39; | grep -E -o &amp;#39;[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}&amp;#39; | while read line; do&#xA;&#x9;&#x9;&#x9;echo &amp;#34;push \&amp;#34;dhcp-option DNS $line\&amp;#34;&amp;#34; &amp;gt;&amp;gt; /etc/openvpn/server/server.conf&#xA;&#x9;&#x9;done&#xA;&#x9;&#x9;;;&#xA;&#x9;&#x9;2)&#xA;&#x9;&#x9;echo &amp;#39;push &amp;#34;dhcp-option DNS 1.1.1.1&amp;#34;&amp;#39; &amp;gt;&amp;gt; /etc/openvpn/server/server.conf&#xA;&#x9;&#x9;echo &amp;#39;push &amp;#34;dhcp-option DNS 1.0.0.1&amp;#34;&amp;#39; &amp;gt;&amp;gt; /etc/openvpn/server/server.conf&#xA;&#x9;&#x9;;;&#xA;&#x9;&#x9;3)&#xA;&#x9;&#x9;echo &amp;#39;push &amp;#34;dhcp-option DNS 8.8.8.8&amp;#34;&amp;#39; &amp;gt;&amp;gt; /etc/openvpn/server/server.conf&#xA;&#x9;&#x9;echo &amp;#39;push &amp;#34;dhcp-option DNS 8.8.4.4&amp;#34;&amp;#39; &amp;gt;&amp;gt; /etc/openvpn/server/server.conf&#xA;&#x9;&#x9;;;&#xA;&#x9;&#x9;4)&#xA;&#x9;&#x9;echo &amp;#39;push &amp;#34;dhcp-option DNS 208.67.222.222&amp;#34;&amp;#39; &amp;gt;&amp;gt; /etc/openvpn/server/server.conf&#xA;&#x9;&#x9;echo &amp;#39;push &amp;#34;dhcp-option DNS 208.67.220.220&amp;#34;&amp;#39; &amp;gt;&amp;gt; /etc/openvpn/server/server.conf&#xA;&#x9;&#x9;;;&#xA;&#x9;&#x9;5)&#xA;&#x9;&#x9;echo &amp;#39;push &amp;#34;dhcp-option DNS 64.6.64.6&amp;#34;&amp;#39; &amp;gt;&amp;gt; /etc/openvpn/server/server.conf&#xA;&#x9;&#x9;echo &amp;#39;push &amp;#34;dhcp-option DNS 64.6.65.6&amp;#34;&amp;#39; &amp;gt;&amp;gt; /etc/openvpn/server/server.conf&#xA;&#x9;&#x9;;;&#xA;&#x9;esac&#xA;&#x9;echo &amp;#34;keepalive 10 120&#xA;cipher AES-256-CBC&#xA;user nobody&#xA;group $GROUPNAME&#xA;persist-key&#xA;persist-tun&#xA;status openvpn-status.log&#xA;verb 3&#xA;crl-verify crl.pem&amp;#34; &amp;gt;&amp;gt; /etc/openvpn/server/server.conf&#xA;&#x9;# Enable net.ipv4.ip_forward for the system&#xA;&#x9;echo &amp;#39;net.ipv4.ip_forward=1&amp;#39; &amp;gt; /etc/sysctl.d/30-openvpn-forward.conf&#xA;&#x9;# Enable without waiting for a reboot or service restart&#xA;&#x9;echo 1 &amp;gt; /proc/sys/net/ipv4/ip_forward&#xA;&#x9;if pgrep firewalld; then&#xA;&#x9;&#x9;# Using both permanent and not permanent rules to avoid a firewalld&#xA;&#x9;&#x9;# reload.&#xA;&#x9;&#x9;# We don&amp;#39;t use --add-service=openvpn because that would only work with&#xA;&#x9;&#x9;# the default port and protocol.&#xA;&#x9;&#x9;firewall-cmd --add-port=$PORT/$PROTOCOL&#xA;&#x9;&#x9;firewall-cmd --zone=trusted --add-source=10.8.0.0/24&#xA;&#x9;&#x9;firewall-cmd --permanent --add-port=$PORT/$PROTOCOL&#xA;&#x9;&#x9;firewall-cmd --permanent --zone=trusted --add-source=10.8.0.0/24&#xA;&#x9;&#x9;# Set NAT for the VPN subnet&#xA;&#x9;&#x9;firewall-cmd --direct --add-rule ipv4 nat POSTROUTING 0 -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to $IP&#xA;&#x9;&#x9;firewall-cmd --permanent --direct --add-rule ipv4 nat POSTROUTING 0 -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to $IP&#xA;&#x9;else&#xA;&#x9;&#x9;# Create a service to set up persistent iptables rules&#xA;&#x9;&#x9;echo &amp;#34;[Unit]&#xA;Before=network.target&#xA;[Service]&#xA;Type=oneshot&#xA;ExecStart=/sbin/iptables -t nat -A POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to $IP&#xA;ExecStart=/sbin/iptables -I INPUT -p $PROTOCOL --dport $PORT -j ACCEPT&#xA;ExecStart=/sbin/iptables -I FORWARD -s 10.8.0.0/24 -j ACCEPT&#xA;ExecStart=/sbin/iptables -I FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT&#xA;ExecStop=/sbin/iptables -t nat -D POSTROUTING -s 10.8.0.0/24 ! -d 10.8.0.0/24 -j SNAT --to $IP&#xA;ExecStop=/sbin/iptables -D INPUT -p $PROTOCOL --dport $PORT -j ACCEPT&#xA;ExecStop=/sbin/iptables -D FORWARD -s 10.8.0.0/24 -j ACCEPT&#xA;ExecStop=/sbin/iptables -D FORWARD -m state --state RELATED,ESTABLISHED -j ACCEPT&#xA;RemainAfterExit=yes&#xA;[Install]&#xA;WantedBy=multi-user.target&amp;#34; &amp;gt; /etc/systemd/system/openvpn-iptables.service&#xA;&#x9;&#x9;systemctl enable --now openvpn-iptables.service&#xA;&#x9;fi&#xA;&#x9;# If SELinux is enabled and a custom port was selected, we need this&#xA;&#x9;if sestatus 2&amp;gt;/dev/null | grep &amp;#34;Current mode&amp;#34; | grep -q &amp;#34;enforcing&amp;#34; &amp;amp;&amp;amp; [[ &amp;#34;$PORT&amp;#34; != &amp;#39;1194&amp;#39; ]]; then&#xA;&#x9;&#x9;# Install semanage if not already present&#xA;&#x9;&#x9;if ! hash semanage 2&amp;gt;/dev/null; then&#xA;&#x9;&#x9;&#x9;if grep -qs &amp;#34;CentOS Linux release 7&amp;#34; &amp;#34;/etc/centos-release&amp;#34;; then&#xA;&#x9;&#x9;&#x9;&#x9;yum install policycoreutils-python -y&#xA;&#x9;&#x9;&#x9;else&#xA;&#x9;&#x9;&#x9;&#x9;yum install policycoreutils-python-utils -y&#xA;&#x9;&#x9;&#x9;fi&#xA;&#x9;&#x9;fi&#xA;&#x9;&#x9;semanage port -a -t openvpn_port_t -p $PROTOCOL $PORT&#xA;&#x9;fi&#xA;&#x9;# And finally, enable and start the OpenVPN service&#xA;&#x9;systemctl enable --now openvpn-server@server.service&#xA;&#x9;# If the server is behind a NAT, use the correct IP address&#xA;&#x9;if [[ &amp;#34;$PUBLICIP&amp;#34; != &amp;#34;&amp;#34; ]]; then&#xA;&#x9;&#x9;IP=$PUBLICIP&#xA;&#x9;fi&#xA;&#x9;# client-common.txt is created so we have a template to add further users later&#xA;&#x9;echo &amp;#34;client&#xA;dev tun&#xA;proto $PROTOCOL&#xA;sndbuf 0&#xA;rcvbuf 0&#xA;remote $IP $PORT&#xA;resolv-retry infinite&#xA;nobind&#xA;persist-key&#xA;persist-tun&#xA;remote-cert-tls server&#xA;auth SHA512&#xA;cipher AES-256-CBC&#xA;setenv opt block-outside-dns&#xA;key-direction 1&#xA;verb 3&amp;#34; &amp;gt; /etc/openvpn/server/client-common.txt&#xA;&#x9;# Generates the custom client.ovpn&#xA;&#x9;newclient &amp;#34;$CLIENT&amp;#34;&#xA;&#x9;echo&#xA;&#x9;echo &amp;#34;Finished!&amp;#34;&#xA;&#x9;echo&#xA;&#x9;echo &amp;#34;Your client configuration is available at:&amp;#34; ~/&amp;#34;$CLIENT.ovpn&amp;#34;&#xA;&#x9;echo &amp;#34;If you want to add more clients, you simply need to run this script again!&amp;#34;&#xA;fi&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;br/&gt;&#xA;&lt;h2 id=&#34;configurer-ssh-sur-raspberry-pi-et-ubuntu-mate-facultatif&#34;&gt;Configurer SSH sur raspberry pi et Ubuntu Mate (facultatif)&lt;/h2&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo systemctl enable ssh&#xA;sudo service ssh restart&#xA;&#xA;sudo dpkg-reconfigure openssh-server&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;br/&gt;&#xA;&lt;h2 id=&#34;configurer-un-client-openvpn&#34;&gt;Configurer un client OpenVPN&lt;/h2&gt;&#xA;&lt;pre tabindex=&#34;0&#34;&gt;&lt;code&gt;sudo apt-get install openvpn&#xA;sudo openvpn --config /path/to/config.ovpn&#xA;&lt;/code&gt;&lt;/pre&gt;&lt;p&gt;Pour rendre la connexion permanente, éditer le fichier &lt;code&gt;/etc/default/openvpn&lt;/code&gt; et décommenter la ligne &lt;code&gt;AUTOSTART=&amp;quot;all&amp;quot;&lt;/code&gt; et copier le fichier &lt;code&gt;.ovpn&lt;/code&gt; comme ceci (attention à bien renommer l&amp;rsquo;extension): &lt;code&gt;/etc/openvpn/config.conf&lt;/code&gt;&lt;/p&gt;</description>
    </item>
  </channel>
</rss>
